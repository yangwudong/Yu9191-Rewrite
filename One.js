/*
 * 软件名称: One·一个
 * 脚本说明: 解锁所有内容(包含付费), 去除全局广告
 * 仅适配2.2.3版本

[rewrite_local]
https:\/\/api\.\w+\.com\/v2\.4\/(bootstrap|article\/detail) url script-response-body https://raw.githubusercontent.com/Yu9191/Rewrite/refs/heads/main/One.js
[mitm]
hostname = api.3459381.com, api.61c76a0.com, api.87735d5.com, api.afe9a49.com, api.c6dd5cc.com, api.2b37894.com, api.35a46dd.com, api.43b8477.com, api.5ce3771.com, api.632d809.com, api.b675211.com, api.a9a2bc4.com, api.8eb269a.com, api.4c86d03.com, api.979bb9e.com, api.988068b.com, api.9cbd862.com, api.c2e777b.com, api.b676039.com, api.ab1e7ee.com, api.5ed249d.com, api.2b1daea.com, api.4934430.com, api.645fb8d.com, api.53cuk7g.com, api.5ebd5d.com, api.em1oifd0.com, api*-uat.*.com, jmtp.*.com, api.k55n2r.com, api.zbdk8ws.com, api.26bb4xt.com, api.vf5x3hv.com

*/
var iｉl='jsjiami.com.v7';const I1illI1=lliIli11;(function(Iliil1l1,lI1Ii1iI,IiIlIiil,IlIIiil,IIIllill,l1lIll1l,i1i){return Iliil1l1=Iliil1l1>>0x3,l1lIll1l='hs',i1i='hs',function(lillliI1,I1Ill1lI,lI1llI1I,iI1Illl1,liiiII11){const i1Il1li=lliIli11;iI1Illl1='tfi',l1lIll1l=iI1Illl1+l1lIll1l,liiiII11='up',i1i+=liiiII11,l1lIll1l=lI1llI1I(l1lIll1l),i1i=lI1llI1I(i1i),lI1llI1I=0x0;const i1lIIlii=lillliI1();while(!![]&&--IlIIiil+I1Ill1lI){try{iI1Illl1=parseInt(i1Il1li(0x172,'(YRa'))/0x1*(-parseInt(i1Il1li(0x1bd,'$a^t'))/0x2)+-parseInt(i1Il1li(0x171,'kM$A'))/0x3*(parseInt(i1Il1li(0x184,'U!4D'))/0x4)+-parseInt(i1Il1li(0x176,'gIBG'))/0x5*(parseInt(i1Il1li(0x17c,'U!4D'))/0x6)+parseInt(i1Il1li(0x1a1,'abof'))/0x7*(parseInt(i1Il1li(0x16c,'*23!'))/0x8)+parseInt(i1Il1li(0x162,'RGe0'))/0x9*(parseInt(i1Il1li(0x1be,'ETC7'))/0xa)+parseInt(i1Il1li(0x188,'gIBG'))/0xb*(parseInt(i1Il1li(0x1b0,'kM$A'))/0xc)+parseInt(i1Il1li(0x1a5,'*23!'))/0xd*(parseInt(i1Il1li(0x165,'^@h8'))/0xe);}catch(llIiIi1I){iI1Illl1=lI1llI1I;}finally{liiiII11=i1lIIlii[l1lIll1l]();if(Iliil1l1<=IlIIiil)lI1llI1I?IIIllill?iI1Illl1=liiiII11:IIIllill=liiiII11:lI1llI1I=liiiII11;else{if(lI1llI1I==IIIllill['replace'](/[VelAHutqUWSIfnrOdG=]/g,'')){if(iI1Illl1===I1Ill1lI){i1lIIlii['un'+l1lIll1l](liiiII11);break;}i1lIIlii[i1i](liiiII11);}}}}}(IiIlIiil,lI1Ii1iI,function(lIIiiI1I,iI1lill,Ili1i11I,l1iillI1,II1I11i1,IlIiI1i,iIIIIli1){return iI1lill='\x73\x70\x6c\x69\x74',lIIiiI1I=arguments[0x0],lIIiiI1I=lIIiiI1I[iI1lill](''),Ili1i11I='\x72\x65\x76\x65\x72\x73\x65',lIIiiI1I=lIIiiI1I[Ili1i11I]('\x76'),l1iillI1='\x6a\x6f\x69\x6e',(0x184664,lIIiiI1I[l1iillI1](''));});}(0x630,0x26cd7,lilIiilI,0xc8),lilIiilI)&&(iｉl=0xc8);function lilIiilI(){const Ii1l1IiI=(function(){return[iｉl,'nWHjVtsfujOqiUaldrmWGdie.AcrSoWVmft.IUv7==','E8kaWQDUW7fGW77cVmkZoWC','lSo5daHa','5l6F6ighWP/cQxNcRK5qW5RdPeyVua','oNrktvRdUSknomkVhuy','W67dJmk4n8kHW640WR7cLfziWOxcSmoRWPxcQ8osFSkCW6tdNxz8bYSRAwFcTCkPyCoYW4xdVConWPtcQ27cS8kuW7NcVCkYWQymvIm+W4lcP8omgwaWxabmtCoaW6WMW7y','z8o75BYO5AEN5lQp6l+/n8k1W6idW63KU4NNO6i','xmkoWQBcTq','FSkTW53cV8oakJeQ','DCkQW67cPmkboCoWW4VdJW','rXRcPSoFWOPuvW','D8kPWRZdLSkivL9MACktsYy8wa','WPSLeW9C','W6tcGuzWCvFdNSoQW5O','BxxcGCkGfmkYdSoKW5FcHCoyWQy','r8kMW5dcHLi','iGpcRCo2WO0','xqJdP10','s8kbW6ni','WOhcUSkQW48','bSo1W6pcRuCrW6q2','uH9NpbBcPmkBW7uNWRO','kCkZtui','eXxdVCoAra','Cmo9a8kWAa','W4WNWQxcOa','WRW+WRBcT8kT','mCkkW73cMvVdO8oAWP4Ipru','bSo+WPBdGau4W5GiiSo1Da','W7DJtCoT','WPJdLbNcHehdR8k5lWXgW4XhW4eUECk8FueU','xComemku','A3BcGCkKhSk7lSoiW43cTSo0WPm','WO5aW7O','W4C0BCkH','ySoFW5pdRG','W4WGW5fIkhLqvSoeW5qnWOddSa','WR/cIh7dUa','fWRcJmkvWOz4qsBcONnYgSoEW5W','DSoFW5xdVgi','tCkZb8okW5pcM8kVW6ZcPmk3W4xcRCknWOC','WPdcQmk7W5W','ebNcNCkv','xclcOHldTa','oSoSW7NcLq','bZ3cNSkUWPq','WQieWPRcJf4','mCopjW','uCk1W7FcG3y','rmo4ga'].concat((function(){return['d0NdVXe','W5SOzW','u8kdW5dcR0q','WPNdKXNdOYVcQmoVtN0','fCoLW57cHSoh','sayR','h8oTW6WtWRm','n8kmbSocedLhWQ8','sqvW','WRlcHNFdUa','W79IsSo6WQeNiq','o3fmqZRdLSk7c8k/fa','bWJcHCkDWOy','WQ9cW5KCiG','WO5cWP0uwG','W4FcHSof','oCkotSkvWQyUWPNcMJSUDa','fu8JvKhcSCkaW5yMWQfW','tCofWRVcGCo8','pNbms1VcOSkdomkaouHZ','acdcUCokWRn0taFcIW','aIZcUSoH','D8kPW63cVCkTfSoBW77dOW','WPjoW7K','u8oIeSkQmCoTWP4lWR8','cXVcQx/dSSoBDq','4PYSrmovW5/dHCo5hUwjO+I8UUAiUUwiR8okWRFORlhNUPFNUAC','cqZcN3VdIG','WQe3sSoX','q8koW4NcSW','vmk0eG','WPpcRmk7W5LYg1i','WOPWW60hW5e','bKpdQbC','tmo6WRxcO8onWOhcIG','W5SKWP5eWPldRgRdI2/cGSou','W4v0gSo7WQVcTvRcQwVcKCk+WRpdPG','rXLZbKNdVa','WOv0W4qsW5tdIW','W5BcKfqB','hstcSeVdMW','W7G1dhCvva','W4yuWQDOFmouESoXBSk+WPm6xNhcHd8','zmolW54','W4BdUCo2WOq+xWPUWOnI','h0pdNWBdSf1qW60','aCoDW7SRWRm','WPlcR8oNWQzruSk1','5PYJ556M6zwH6k6v','fwhcH8oTW7y','WQhcIghdRSof'].concat((function(){return['lCozW7y','WRjHW7WVW7ypWQdcPmo8cmkkWOGwW4HoW6fzbrhcJ3S','zSozg8oj','WOjGW68HW6y','s8koW4a','WR/cGhddTSood8kSWO0','W7fWW7/dL2VcG2jCW4NdHW','WPFcQmkiW49I','lIpdHSoL','WO/dL2m','W7LWdgHCAW1gWPlcHmoLBfnMtCox','WQhcVCkPWOu','tgNNV5RLR43KU7lLRyNLNji3WPpdMZ/dPEs6NUEGLSkiW7NOTjNOVklKUyhOV6q','AmkOW4xcKLO','xSk0fa','WPekvSk5W7W','WQySWQG','umojiSoGcdrCWODHW5q','W5GLWPS/W4VdU1ZdMvC','W6JcQ8oH','orZdK8oiuq','W4dcPxHODW','W67cQe8k','W73cN1yvW5u','tSoQfJRdM8k9fSkjWO/cQue','WOVdM1ldHuK','BCkBWRtdRa','B8oqWQ4','z8oEWR3dIq','s8kaW6O','WPvuW74hW7a','gbFcJG','vmoCpSoMoq','CsBdUgVdNa','W7/cU8omWPHV','WRPiW6iIW7e','8j2yUfy','FCkUW5hcQCoBpd4z','5O6m5y6h5OIL6zAYWPBcTq','WPTpW70','ztdcHG','pmoyW4yTWRfHW7/cJq','hSkNW6lcUgOBda','drhcRNq','wHZcUeFcUW1/W7dcLmkKW54f','W7j0W7pdLWhcTLbrW6tdMLi','W5VcImoqWRTn','n8oTW4JdHvlcRYO','nwVcLSoTWQq'];}()));}()));}());lilIiilI=function(){return Ii1l1IiI;};return lilIiilI();}function lliIli11(_0xdeaa1a,_0x214c66){const _0x2abe23=lilIiilI();return lliIli11=function(_0x56e9ba,_0x5d7385){_0x56e9ba=_0x56e9ba-0x151;let _0x31e380=_0x2abe23[_0x56e9ba];if(lliIli11['snIhbe']===undefined){var _0x202670=function(_0x7e2db2){const _0x55fd08='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5c0221='',_0x1336cb='';for(let _0x4d1720=0x0,_0x27441a,_0x41c0be,_0x4628ab=0x0;_0x41c0be=_0x7e2db2['charAt'](_0x4628ab++);~_0x41c0be&&(_0x27441a=_0x4d1720%0x4?_0x27441a*0x40+_0x41c0be:_0x41c0be,_0x4d1720++%0x4)?_0x5c0221+=String['fromCharCode'](0xff&_0x27441a>>(-0x2*_0x4d1720&0x6)):0x0){_0x41c0be=_0x55fd08['indexOf'](_0x41c0be);}for(let _0xa5243e=0x0,_0x1f28c3=_0x5c0221['length'];_0xa5243e<_0x1f28c3;_0xa5243e++){_0x1336cb+='%'+('00'+_0x5c0221['charCodeAt'](_0xa5243e)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x1336cb);};const _0x19b74a=function(_0x6d7e3d,_0xb1d73d){let _0x20d487=[],_0x3bf17e=0x0,_0x5777bb,_0xcb4101='';_0x6d7e3d=_0x202670(_0x6d7e3d);let _0x4fb2a6;for(_0x4fb2a6=0x0;_0x4fb2a6<0x100;_0x4fb2a6++){_0x20d487[_0x4fb2a6]=_0x4fb2a6;}for(_0x4fb2a6=0x0;_0x4fb2a6<0x100;_0x4fb2a6++){_0x3bf17e=(_0x3bf17e+_0x20d487[_0x4fb2a6]+_0xb1d73d['charCodeAt'](_0x4fb2a6%_0xb1d73d['length']))%0x100,_0x5777bb=_0x20d487[_0x4fb2a6],_0x20d487[_0x4fb2a6]=_0x20d487[_0x3bf17e],_0x20d487[_0x3bf17e]=_0x5777bb;}_0x4fb2a6=0x0,_0x3bf17e=0x0;for(let _0x2909e8=0x0;_0x2909e8<_0x6d7e3d['length'];_0x2909e8++){_0x4fb2a6=(_0x4fb2a6+0x1)%0x100,_0x3bf17e=(_0x3bf17e+_0x20d487[_0x4fb2a6])%0x100,_0x5777bb=_0x20d487[_0x4fb2a6],_0x20d487[_0x4fb2a6]=_0x20d487[_0x3bf17e],_0x20d487[_0x3bf17e]=_0x5777bb,_0xcb4101+=String['fromCharCode'](_0x6d7e3d['charCodeAt'](_0x2909e8)^_0x20d487[(_0x20d487[_0x4fb2a6]+_0x20d487[_0x3bf17e])%0x100]);}return _0xcb4101;};lliIli11['fbKyne']=_0x19b74a,_0xdeaa1a=arguments,lliIli11['snIhbe']=!![];}const _0x5835e2=_0x2abe23[0x0],_0x2914cb=_0x56e9ba+_0x5835e2,_0x570647=_0xdeaa1a[_0x2914cb];return!_0x570647?(lliIli11['yQWGzu']===undefined&&(lliIli11['yQWGzu']=!![]),_0x31e380=lliIli11['fbKyne'](_0x31e380,_0x5d7385),_0xdeaa1a[_0x2914cb]=_0x31e380):_0x31e380=_0x570647,_0x31e380;},lliIli11(_0xdeaa1a,_0x214c66);};const $=new Env(I1illI1(0x1b8,'yKSk'),{'logLevel':I1illI1(0x18a,'Sy42')});((async()=>{const iiIIlIi=I1illI1,iI1lil1={'QaujB':function(IiIl1Ii){return IiIl1Ii();},'sUzDJ':function(liiIl1I,III1ll,iiiiiiiI,IIIilIiI,lII1Ii1l){return liiIl1I(III1ll,iiiiiiiI,IIIilIiI,lII1Ii1l);},'QcGCk':iiIIlIi(0x1d7,'9o^7'),'OAvXu':iiIIlIi(0x1c4,'xmXh'),'ZzBaw':function(ii11lIlI,iliii1li){return ii11lIlI+iliii1li;},'cZfYv':iiIIlIi(0x1bf,'z]BP'),'OIbDI':function(lIil1,Ii1illli){return lIil1!==Ii1illli;},'dDrZs':function(lIii1lll,iiIIll1l){return lIii1lll+iiIIll1l;},'ISHKc':iiIIlIi(0x15e,'l1)2'),'oWOAw':iiIIlIi(0x1ca,'*23!'),'TJdcR':iiIIlIi(0x1e5,'EQEV'),'TRnPG':iiIIlIi(0x16b,'^@h8'),'zPgXj':iiIIlIi(0x1c6,'H5]e'),'wXwzT':iiIIlIi(0x173,'uG7*'),'CAJKe':iiIIlIi(0x186,'PHRv'),'kqETF':iiIIlIi(0x1ce,'Gxiz'),'SYHWQ':function(Ii11lIl1,ilII1iI1,I1lilIII,lIII111l,iI11Ii1l){return Ii11lIl1(ilII1iI1,I1lilIII,lIII111l,iI11Ii1l);}},illl1=await iI1lil1[iiIIlIi(0x158,'abof')](loadUtils),ii1I1IiI=illl1[iiIIlIi(0x18e,'!p)6')]();var ii1iilii=$response[iiIIlIi(0x163,'[3bf')];$[iiIIlIi(0x1d1,'RGe0')](ii1iilii),ii1iilii=iI1lil1[iiIIlIi(0x1a8,'rcl#')](AES_Decrypt,ii1iilii,ii1I1IiI[iiIIlIi(0x1d6,'mjpB')][iiIIlIi(0x1b6,'ETC7')][iiIIlIi(0x166,'kk#6')](iI1lil1[iiIIlIi(0x1a7,'xmXh')]),ii1I1IiI[iiIIlIi(0x1dd,'^@h8')][iiIIlIi(0x1c1,'IB@1')][iiIIlIi(0x18f,'AG]g')](iI1lil1[iiIIlIi(0x159,'q$dM')]),ii1I1IiI),ii1iilii=JSON[iiIIlIi(0x177,'U!4D')](ii1iilii);const IIil11II=ii1iilii[iiIIlIi(0x1a3,'D4j5')]||0x0;$[iiIIlIi(0x153,'E%uD')](iI1lil1[iiIIlIi(0x19e,'uG7*')](iI1lil1[iiIIlIi(0x1e1,'gIBG')],IIil11II));if(iI1lil1[iiIIlIi(0x1da,'RGe0')](IIil11II,0xc8))$[iiIIlIi(0x174,'b*Ox')](iI1lil1[iiIIlIi(0x19c,'U!4D')](iI1lil1[iiIIlIi(0x17f,'gIBG')],ii1iilii[iiIIlIi(0x1a2,'z]BP')]||iI1lil1[iiIIlIi(0x16a,'uSsH')])),$[iiIIlIi(0x1e3,'EwZF')]({});else{if(/\/bootstrap/[iiIIlIi(0x1af,'(YRa')]($request[iiIIlIi(0x19b,'Sy42')])){const I1I11iII=iI1lil1[iiIIlIi(0x178,'(YRa')][iiIIlIi(0x1a6,'!p)6')]('|');let I1IIliI1=0x0;while(!![]){switch(I1I11iII[I1IIliI1++]){case'0':ii1iilii[iiIIlIi(0x18b,'AG]g')][iiIIlIi(0x17b,'H5]e')][iiIIlIi(0x1d2,'D4j5')]=iI1lil1[iiIIlIi(0x15a,'kk#6')];continue;case'1':ii1iilii[iiIIlIi(0x18b,'AG]g')][iiIIlIi(0x17d,'z]BP')]=iI1lil1[iiIIlIi(0x193,'e0]n')];continue;case'2':ii1iilii[iiIIlIi(0x181,'LEqb')][iiIIlIi(0x194,'uG7*')][iiIIlIi(0x1c3,'9o^7')]=iI1lil1[iiIIlIi(0x1e4,'EwZF')];continue;case'3':ii1iilii[iiIIlIi(0x154,'E%uD')][iiIIlIi(0x190,'yKSk')]=iI1lil1[iiIIlIi(0x1e2,'IB@1')];continue;case'4':ii1iilii[iiIIlIi(0x152,'vNo@')][iiIIlIi(0x19a,'%S9h')]=iI1lil1[iiIIlIi(0x1d0,'$a^t')];continue;case'5':ii1iilii[iiIIlIi(0x192,'!p)6')][iiIIlIi(0x17a,'Uavg')][iiIIlIi(0x1ae,'(YRa')]=0x6;continue;}break;}}/article\/detail/[iiIIlIi(0x1d5,'gIBG')]($request[iiIIlIi(0x155,'Uavg')])&&(ii1iilii[iiIIlIi(0x191,'H5]e')][iiIIlIi(0x1c5,'AG]g')]=0x1,ii1iilii[iiIIlIi(0x192,'!p)6')][iiIIlIi(0x179,'q$dM')]=0x0);const li1il11l=iI1lil1[iiIIlIi(0x15b,'$a^t')](AES_Encrypt,JSON[iiIIlIi(0x1b2,'gi7o')](ii1iilii),ii1I1IiI[iiIIlIi(0x15f,'xmXh')][iiIIlIi(0x16f,'vNo@')][iiIIlIi(0x1cc,'D4j5')](iI1lil1[iiIIlIi(0x182,'Ug$m')]),ii1I1IiI[iiIIlIi(0x1db,'yKSk')][iiIIlIi(0x187,'TD]L')][iiIIlIi(0x168,'Ae#T')](iI1lil1[iiIIlIi(0x156,'Gxiz')]),ii1I1IiI);$[iiIIlIi(0x1b7,'RGe0')]({'body':li1il11l});}})());function AES_Decrypt(iIi1111I,lili111I,iI1iiil,lIIl11ii){const IllIIil1=I1illI1;var l1ili1Il=lIIl11ii[IllIIil1(0x199,'abof')][IllIIil1(0x1b3,'[3bf')](iIi1111I,lili111I,{'iv':iI1iiil,'mode':lIIl11ii[IllIIil1(0x1bb,'%S9h')][IllIIil1(0x160,'e0]n')],'padding':lIIl11ii[IllIIil1(0x197,'uSsH')][IllIIil1(0x1cb,'Ae#T')]});return l1ili1Il[IllIIil1(0x161,'bV&B')](lIIl11ii[IllIIil1(0x1cd,'bV&B')][IllIIil1(0x1d8,'H5]e')]);}function AES_Encrypt(I1ll11l,llli1i11,i111I1iI,i1Il111){const lI11l1l1=I1illI1;var IliiII1i=i1Il111[lI11l1l1(0x19f,'*23!')][lI11l1l1(0x1a4,'(vt[')](I1ll11l,llli1i11,{'iv':i111I1iI,'mode':i1Il111[lI11l1l1(0x185,'(vt[')][lI11l1l1(0x1e0,'kk#6')],'padding':i1Il111[lI11l1l1(0x189,'xmXh')][lI11l1l1(0x180,'gi7o')]});return IliiII1i[lI11l1l1(0x1c7,'%S9h')]();}async function loadUtils(){const iilIiiil=I1illI1,IIilIili={'rZzFP':iilIiiil(0x1de,'abof'),'caGrq':function(li1I1l1I,l1i1Ilii){return li1I1l1I(l1i1Ilii);},'frUvA':function(iiIl11iI){return iiIl11iI();},'abRAI':iilIiiil(0x16d,'9Id%'),'aFQbg':function(iIi1i1Ii,ilI11Ii1){return iIi1i1Ii(ilI11Ii1);}};let l11liill=$[iilIiiil(0x1b9,'H5]e')](IIilIili[iilIiiil(0x1c2,'[3bf')])||'';if(l11liill&&l11liill[iilIiiil(0x1c0,'$a^t')])return console[iilIiiil(0x157,'!p)6')]('✅\x20'+$[iilIiiil(0x1cf,'TD]L')]+iilIiiil(0x1d9,'(YRa')),IIilIili[iilIiiil(0x196,'^@h8')](eval,l11liill),IIilIili[iilIiiil(0x1b5,'[3bf')](creatUtils);return console[iilIiiil(0x1b1,'xmXh')](iilIiiil(0x15c,'TD]L')+$[iilIiiil(0x18d,'D4j5')]+iilIiiil(0x16e,'JT&Q')),new Promise(ii1li=>{const IIli1llI=iilIiiil,liIilIII={'Ijnrp':IIilIili[IIli1llI(0x1ac,'%^Z&')],'WZyJp':function(ll11l1il,IIi1ii1I){const I1I11IIl=IIli1llI;return IIilIili[I1I11IIl(0x1ba,'$a^t')](ll11l1il,IIi1ii1I);},'sEwZf':function(iI1l1IIi,lliiIi1){const l1I1ilii=IIli1llI;return IIilIili[l1I1ilii(0x1d4,'H5]e')](iI1l1IIi,lliiIi1);},'eIzpo':function(lIIllIiI){const lIIIlII1=IIli1llI;return IIilIili[lIIIlII1(0x198,'U!4D')](lIIllIiI);}};$[IIli1llI(0x175,'IB@1')](IIilIili[IIli1llI(0x151,'mjpB')])[IIli1llI(0x17e,'JT&Q')](iI1Iii1=>{const lIill=IIli1llI;$[lIill(0x1bc,'%^Z&')](iI1Iii1,liIilIII[lIill(0x1c8,'bV&B')]),liIilIII[lIill(0x1a0,'bV&B')](eval,iI1Iii1),console[lIill(0x1a9,'kk#6')](lIill(0x1b4,'l1)2')),liIilIII[lIill(0x195,'!p)6')](ii1li,liIilIII[lIill(0x1dc,'ETC7')](creatUtils));});});}var version_ = 'jsjiami.com.v7';

function Env(t,e){class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,a)=>{s.call(this,t,(t,s,r)=>{t?a(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}getEnv(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":void 0}isNode(){return"Node.js"===this.getEnv()}isQuanX(){return"Quantumult X"===this.getEnv()}isSurge(){return"Surge"===this.getEnv()}isLoon(){return"Loon"===this.getEnv()}isShadowrocket(){return"Shadowrocket"===this.getEnv()}isStash(){return"Stash"===this.getEnv()}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const a=this.getdata(t);if(a)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,a)=>e(a))})}runScript(t,e){return new Promise(s=>{let a=this.getdata("@chavy_boxjs_userCfgs.httpapi");a=a?a.replace(/\n/g,"").trim():a;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[i,o]=a.split("@"),n={url:`http://${o}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":i,Accept:"*/*"},timeout:r};this.post(n,(t,e,a)=>s(a))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),a=!s&&this.fs.existsSync(e);if(!s&&!a)return{};{const a=s?t:e;try{return JSON.parse(this.fs.readFileSync(a))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),a=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):a?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const a=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of a)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,a)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[a+1])>>0==+e[a+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,a]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,a,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,a,r]=/^@(.*?)\.(.*?)$/.exec(e),i=this.getval(a),o=a?"null"===i?null:i||"{}":"{}";try{const e=JSON.parse(o);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),a)}catch(e){const i={};this.lodash_set(i,r,t),s=this.setval(JSON.stringify(i),a)}}else s=this.setval(t,e);return s}getval(t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(t);case"Quantumult X":return $prefs.valueForKey(t);case"Node.js":return this.data=this.loaddata(),this.data[t];default:return this.data&&this.data[t]||null}}setval(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(t,e);case"Quantumult X":return $prefs.setValueForKey(t,e);case"Node.js":return this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0;default:return this.data&&this.data[e]||null}}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){switch(t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"],delete t.headers["content-type"],delete t.headers["content-length"]),t.params&&(t.url+="?"+this.queryStr(t.params)),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,a)=>{!t&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,a)});break;case"Quantumult X":this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:a,headers:r,body:i,bodyBytes:o}=t;e(null,{status:s,statusCode:a,headers:r,body:i,bodyBytes:o},i,o)},t=>e(t&&t.error||"UndefinedError"));break;case"Node.js":let s=require("iconv-lite");this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:a,statusCode:r,headers:i,rawBody:o}=t,n=s.decode(o,this.encoding);e(null,{status:a,statusCode:r,headers:i,rawBody:o,body:n},n)},t=>{const{message:a,response:r}=t;e(a,r,r&&s.decode(r.rawBody,this.encoding))})}}post(t,e=(()=>{})){const s=t.method?t.method.toLocaleLowerCase():"post";switch(t.body&&t.headers&&!t.headers["Content-Type"]&&!t.headers["content-type"]&&(t.headers["content-type"]="application/x-www-form-urlencoded"),t.headers&&(delete t.headers["Content-Length"],delete t.headers["content-length"]),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient[s](t,(t,s,a)=>{!t&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,a)});break;case"Quantumult X":t.method=s,this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:a,headers:r,body:i,bodyBytes:o}=t;e(null,{status:s,statusCode:a,headers:r,body:i,bodyBytes:o},i,o)},t=>e(t&&t.error||"UndefinedError"));break;case"Node.js":let a=require("iconv-lite");this.initGotEnv(t);const{url:r,...i}=t;this.got[s](r,i).then(t=>{const{statusCode:s,statusCode:r,headers:i,rawBody:o}=t,n=a.decode(o,this.encoding);e(null,{status:s,statusCode:r,headers:i,rawBody:o,body:n},n)},t=>{const{message:s,response:r}=t;e(s,r,r&&a.decode(r.rawBody,this.encoding))})}}time(t,e=null){const s=e?new Date(e):new Date;let a={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in a)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[e]:("00"+a[e]).substr((""+a[e]).length)));return t}queryStr(t){let e="";for(const s in t){let a=t[s];null!=a&&""!==a&&("object"==typeof a&&(a=JSON.stringify(a)),e+=`${s}=${a}&`)}return e=e.substring(0,e.length-1),e}msg(e=t,s="",a="",r){const i=t=>{switch(typeof t){case void 0:return t;case"string":switch(this.getEnv()){case"Surge":case"Stash":default:return{url:t};case"Loon":case"Shadowrocket":return t;case"Quantumult X":return{"open-url":t};case"Node.js":return}case"object":switch(this.getEnv()){case"Surge":case"Stash":case"Shadowrocket":default:{let e=t.url||t.openUrl||t["open-url"];return{url:e}}case"Loon":{let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}case"Quantumult X":{let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl,a=t["update-pasteboard"]||t.updatePasteboard;return{"open-url":e,"media-url":s,"update-pasteboard":a}}case"Node.js":return}default:return}};if(!this.isMute)switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(e,s,a,i(r));break;case"Quantumult X":$notify(e,s,a,i(r));break;case"Node.js":}if(!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),a&&t.push(a),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:this.log("",`❗️${this.name}, 错误!`,t);break;case"Node.js":this.log("",`❗️${this.name}, 错误!`,t.stack)}}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;switch(this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:$done(t);break;case"Node.js":process.exit(1)}}}(t,e)}
 
